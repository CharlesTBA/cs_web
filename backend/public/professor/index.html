<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Professor Portal</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
  <nav class="bg-green-600 text-white p-4">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-xl font-bold">ğŸ‘¨â€ğŸ« Professor Portal</h1>
    </div>
  </nav>

  <div class="container mx-auto p-6">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Course Management -->
      <div class="bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-bold mb-4">ğŸ“š My Courses</h2>
        <div id="coursesList" class="space-y-2">
          <!-- Courses will be loaded here -->
          <div class="animate-pulse bg-gray-200 h-10 rounded"></div>
          <div class="animate-pulse bg-gray-200 h-10 rounded"></div>
        </div>
      </div>

      <!-- Grade Management -->
      <div class="bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-bold mb-4">ğŸ“Š Manage Grades</h2>
        <div class="space-y-2">
          <button class="w-full p-2 bg-green-500 text-white rounded" onclick="location.href='grades/enter'">Enter Grades</button>
          <button class="w-full p-2 bg-green-500 text-white rounded" onclick="location.href='grades/view'">View Records</button>
        </div>
      </div>

      <!-- Attendance -->
      <div class="bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-bold mb-4">ğŸ“‹ Attendance</h2>
        <div class="space-y-2">
          <button class="w-full p-2 bg-green-500 text-white rounded" onclick="location.href='attendance/record'">Record Attendance</button>
          <button class="w-full p-2 bg-green-500 text-white rounded" onclick="location.href='attendance/view'">View Records</button>
        </div>
      </div>

      <!-- Announcements -->
      <div class="bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-bold mb-4">ğŸ“¢ Class Announcements</h2>
        <div class="space-y-2">
          <button class="w-full p-2 bg-green-500 text-white rounded" onclick="location.href='announcements'">Post Announcements</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Check if professor is logged in
    window.addEventListener('load', () => {
      const professor = localStorage.getItem('professor')
      if (!professor) {
        window.location.href = '/professor-login'
        return
      }
      try {
        const profData = JSON.parse(professor)
        if (!profData.id || !profData.department) {
          window.location.href = '/professor-login'
          return
        }
        loadProfessorCourses(profData.id)
      } catch (e) {
        window.location.href = '/professor-login'
      }
    })

    // Load professor's courses
    async function loadProfessorCourses(profId) {
      try {
        const res = await fetch(`/api/courses/professor/${profId}`)
        const courses = await res.json()
        const coursesList = document.getElementById('coursesList')
        coursesList.innerHTML = courses.length ? courses.map(c => `
          <button 
            class="w-full p-2 text-left bg-green-50 hover:bg-green-100 rounded flex justify-between items-center"
            onclick="location.href='courses/${c.id}'"
          >
            <span class="font-medium">${c.code} - ${c.name}</span>
            <span class="text-sm text-gray-600">${c.students || 0} students</span>
          </button>
        `).join('') : '<p class="text-gray-500">No courses assigned yet</p>'
      } catch (e) {
        console.error('Failed to load courses:', e)
      }
    }

    // Load courses (no login required)
    async function loadCourses() {
      try {
        const res = await fetch('/api/courses');
        const courses = await res.json();
        const coursesList = document.getElementById('coursesList');
        coursesList.innerHTML = courses.length ? courses.map(c => `
          <button 
            class="w-full p-2 text-left bg-green-50 hover:bg-green-100 rounded flex justify-between items-center"
            onclick="location.href='courses/${c.id}'"
          >
            <span class="font-medium">${c.code} - ${c.name}</span>
            <span class="text-sm text-gray-600">${c.students || 0} students</span>
          </button>
        `).join('') : '<p class="text-gray-500">No courses found</p>';
      } catch (e) {
        console.error('Failed to load courses:', e)
      }
    }

    window.addEventListener('load', loadCourses);
  </script>
</body>
</html>